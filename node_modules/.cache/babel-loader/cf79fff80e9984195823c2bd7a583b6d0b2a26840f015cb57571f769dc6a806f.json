{"ast":null,"code":"import _regeneratorRuntime from \"/Users/rizzytwizzy/Projects/gam3/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/rizzytwizzy/Projects/gam3/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _slicedToArray from \"/Users/rizzytwizzy/Projects/gam3/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _extends from '@babel/runtime/helpers/esm/extends';\nimport * as THREE from 'three';\nimport * as React from 'react';\nimport { forwardRef, useRef, useState, useCallback, useMemo, useImperativeHandle, useEffect, Suspense, useContext, createContext } from 'react';\nimport { useThree, useFrame } from '@react-three/fiber';\nimport { easing } from 'maath';\nimport { suspend, clear } from 'suspend-react';\nimport { useVideoTexture } from './useVideoTexture.js';\nimport { Facemesh } from './Facemesh.js';\nimport { useFaceLandmarker } from './FaceLandmarker.js';\n\n// useVideoTexture 1st arg `src` type\nfunction mean(v1, v2) {\n  return v1.clone().add(v2).multiplyScalar(0.5);\n}\nfunction localToLocal(objSrc, v, objDst) {\n  // see: https://discourse.threejs.org/t/object3d-localtolocal/51564\n  var v_world = objSrc.localToWorld(v);\n  return objDst.worldToLocal(v_world);\n} //\n//\n//\n\nvar FaceControlsContext = /*#__PURE__*/createContext({});\nvar FaceControls = /*#__PURE__*/forwardRef(function (_ref, fref) {\n  var camera = _ref.camera,\n    _ref$autostart = _ref.autostart,\n    autostart = _ref$autostart === void 0 ? true : _ref$autostart,\n    _ref$webcam = _ref.webcam,\n    webcam = _ref$webcam === void 0 ? true : _ref$webcam,\n    webcamVideoTextureSrc = _ref.webcamVideoTextureSrc,\n    _ref$manualUpdate = _ref.manualUpdate,\n    manualUpdate = _ref$manualUpdate === void 0 ? false : _ref$manualUpdate,\n    _ref$manualDetect = _ref.manualDetect,\n    manualDetect = _ref$manualDetect === void 0 ? false : _ref$manualDetect,\n    onVideoFrame = _ref.onVideoFrame,\n    _ref$smoothTime = _ref.smoothTime,\n    smoothTime = _ref$smoothTime === void 0 ? 0.25 : _ref$smoothTime,\n    _ref$offset = _ref.offset,\n    offset = _ref$offset === void 0 ? true : _ref$offset,\n    _ref$offsetScalar = _ref.offsetScalar,\n    offsetScalar = _ref$offsetScalar === void 0 ? 80 : _ref$offsetScalar,\n    _ref$eyes = _ref.eyes,\n    eyes = _ref$eyes === void 0 ? false : _ref$eyes,\n    _ref$eyesAsOrigin = _ref.eyesAsOrigin,\n    eyesAsOrigin = _ref$eyesAsOrigin === void 0 ? true : _ref$eyesAsOrigin,\n    _ref$depth = _ref.depth,\n    depth = _ref$depth === void 0 ? 0.15 : _ref$depth,\n    _ref$debug = _ref.debug,\n    debug = _ref$debug === void 0 ? false : _ref$debug,\n    facemesh = _ref.facemesh,\n    makeDefault = _ref.makeDefault;\n  var _faces$facialTransfor, _faces$faceBlendshape;\n  var scene = useThree(function (state) {\n    return state.scene;\n  });\n  var defaultCamera = useThree(function (state) {\n    return state.camera;\n  });\n  var set = useThree(function (state) {\n    return state.set;\n  });\n  var get = useThree(function (state) {\n    return state.get;\n  });\n  var explCamera = camera || defaultCamera;\n  var webcamApiRef = useRef(null);\n  var facemeshApiRef = useRef(null); //\n  // computeTarget()\n  //\n  // Compute `target` position and rotation for the camera (according to <Facemesh>)\n  //\n  //  1. ðŸ‘€ either following the 2 eyes\n  //  2. ðŸ‘¤ or just the head mesh\n  //\n\n  var _useState = useState(function () {\n      return new THREE.Object3D();\n    }),\n    _useState2 = _slicedToArray(_useState, 1),\n    target = _useState2[0];\n  var _useState3 = useState(function () {\n      return new THREE.Vector3();\n    }),\n    _useState4 = _slicedToArray(_useState3, 1),\n    irisRightDirPos = _useState4[0];\n  var _useState5 = useState(function () {\n      return new THREE.Vector3();\n    }),\n    _useState6 = _slicedToArray(_useState5, 1),\n    irisLeftDirPos = _useState6[0];\n  var _useState7 = useState(function () {\n      return new THREE.Vector3();\n    }),\n    _useState8 = _slicedToArray(_useState7, 1),\n    irisRightLookAt = _useState8[0];\n  var _useState9 = useState(function () {\n      return new THREE.Vector3();\n    }),\n    _useState10 = _slicedToArray(_useState9, 1),\n    irisLeftLookAt = _useState10[0];\n  var computeTarget = useCallback(function () {\n    // same parent as the camera\n    target.parent = explCamera.parent;\n    var facemeshApi = facemeshApiRef.current;\n    if (facemeshApi) {\n      var outerRef = facemeshApi.outerRef,\n        eyeRightRef = facemeshApi.eyeRightRef,\n        eyeLeftRef = facemeshApi.eyeLeftRef;\n      if (eyeRightRef.current && eyeLeftRef.current) {\n        // 1. ðŸ‘€\n        var irisRightDirRef = eyeRightRef.current.irisDirRef;\n        var irisLeftDirRef = eyeLeftRef.current.irisDirRef;\n        if (irisRightDirRef.current && irisLeftDirRef.current && outerRef.current) {\n          //\n          // position: mean of irisRightDirPos,irisLeftDirPos\n          //\n          irisRightDirPos.copy(localToLocal(irisRightDirRef.current, new THREE.Vector3(0, 0, 0), outerRef.current));\n          irisLeftDirPos.copy(localToLocal(irisLeftDirRef.current, new THREE.Vector3(0, 0, 0), outerRef.current));\n          target.position.copy(localToLocal(outerRef.current, mean(irisRightDirPos, irisLeftDirPos), explCamera.parent || scene)); //\n          // lookAt: mean of irisRightLookAt,irisLeftLookAt\n          //\n\n          irisRightLookAt.copy(localToLocal(irisRightDirRef.current, new THREE.Vector3(0, 0, 1), outerRef.current));\n          irisLeftLookAt.copy(localToLocal(irisLeftDirRef.current, new THREE.Vector3(0, 0, 1), outerRef.current));\n          target.lookAt(outerRef.current.localToWorld(mean(irisRightLookAt, irisLeftLookAt)));\n        }\n      } else {\n        // 2. ðŸ‘¤\n        if (outerRef.current) {\n          target.position.copy(localToLocal(outerRef.current, new THREE.Vector3(0, 0, 0), explCamera.parent || scene));\n          target.lookAt(outerRef.current.localToWorld(new THREE.Vector3(0, 0, 1)));\n        }\n      }\n    }\n    return target;\n  }, [explCamera, irisLeftDirPos, irisLeftLookAt, irisRightDirPos, irisRightLookAt, scene, target]); //\n  // update()\n  //\n  // Updating the camera `current` position and rotation, following `target`\n  //\n\n  var _useState11 = useState(function () {\n      return new THREE.Object3D();\n    }),\n    _useState12 = _slicedToArray(_useState11, 1),\n    current = _useState12[0];\n  var update = useCallback(function (delta, target) {\n    if (explCamera) {\n      var _target;\n      (_target = target) !== null && _target !== void 0 ? _target : target = computeTarget();\n      if (smoothTime > 0) {\n        // damping current\n        var eps = 1e-9;\n        easing.damp3(current.position, target.position, smoothTime, delta, undefined, undefined, eps);\n        easing.dampE(current.rotation, target.rotation, smoothTime, delta, undefined, undefined, eps);\n      } else {\n        // instant\n        current.position.copy(target.position);\n        current.rotation.copy(target.rotation);\n      }\n      explCamera.position.copy(current.position);\n      explCamera.rotation.copy(current.rotation);\n    }\n  }, [explCamera, computeTarget, smoothTime, current.position, current.rotation]); //\n  // detect()\n  //\n\n  var _useState13 = useState(),\n    _useState14 = _slicedToArray(_useState13, 2),\n    faces = _useState14[0],\n    setFaces = _useState14[1];\n  var faceLandmarker = useFaceLandmarker();\n  var detect = useCallback(function (video, time) {\n    var faces = faceLandmarker == null ? void 0 : faceLandmarker.detectForVideo(video, time);\n    setFaces(faces);\n  }, [faceLandmarker]);\n  useFrame(function (_, delta) {\n    if (!manualUpdate) {\n      update(delta);\n    }\n  }); // Ref API\n\n  var api = useMemo(function () {\n    return Object.assign(Object.create(THREE.EventDispatcher.prototype), {\n      detect: detect,\n      computeTarget: computeTarget,\n      update: update,\n      facemeshApiRef: facemeshApiRef,\n      webcamApiRef: webcamApiRef,\n      // shorthands\n      play: function play() {\n        var _webcamApiRef$current, _webcamApiRef$current2;\n        (_webcamApiRef$current = webcamApiRef.current) == null ? void 0 : (_webcamApiRef$current2 = _webcamApiRef$current.videoTextureApiRef.current) == null ? void 0 : _webcamApiRef$current2.texture.source.data.play();\n      },\n      pause: function pause() {\n        var _webcamApiRef$current3, _webcamApiRef$current4;\n        (_webcamApiRef$current3 = webcamApiRef.current) == null ? void 0 : (_webcamApiRef$current4 = _webcamApiRef$current3.videoTextureApiRef.current) == null ? void 0 : _webcamApiRef$current4.texture.source.data.pause();\n      }\n    });\n  }, [detect, computeTarget, update]);\n  useImperativeHandle(fref, function () {\n    return api;\n  }, [api]); //\n  // events callbacks\n  //\n\n  useEffect(function () {\n    var onVideoFrameCb = function onVideoFrameCb(e) {\n      if (!manualDetect) detect(e.texture.source.data, e.time);\n      if (onVideoFrame) onVideoFrame(e);\n    };\n    api.addEventListener('videoFrame', onVideoFrameCb);\n    return function () {\n      api.removeEventListener('videoFrame', onVideoFrameCb);\n    };\n  }, [api, detect, faceLandmarker, manualDetect, onVideoFrame]); // `controls` global state\n\n  useEffect(function () {\n    if (makeDefault) {\n      var old = get().controls;\n      set({\n        controls: api\n      });\n      return function () {\n        return set({\n          controls: old\n        });\n      };\n    }\n  }, [makeDefault, api, get, set]);\n  var points = faces == null ? void 0 : faces.faceLandmarks[0];\n  var facialTransformationMatrix = faces == null ? void 0 : (_faces$facialTransfor = faces.facialTransformationMatrixes) == null ? void 0 : _faces$facialTransfor[0];\n  var faceBlendshapes = faces == null ? void 0 : (_faces$faceBlendshape = faces.faceBlendshapes) == null ? void 0 : _faces$faceBlendshape[0];\n  return /*#__PURE__*/React.createElement(FaceControlsContext.Provider, {\n    value: api\n  }, webcam && /*#__PURE__*/React.createElement(Suspense, {\n    fallback: null\n  }, /*#__PURE__*/React.createElement(Webcam, {\n    ref: webcamApiRef,\n    autostart: autostart,\n    videoTextureSrc: webcamVideoTextureSrc\n  })), /*#__PURE__*/React.createElement(Facemesh, _extends({\n    ref: facemeshApiRef\n  }, facemesh, {\n    points: points,\n    depth: depth,\n    facialTransformationMatrix: facialTransformationMatrix,\n    faceBlendshapes: faceBlendshapes,\n    eyes: eyes,\n    eyesAsOrigin: eyesAsOrigin,\n    offset: offset,\n    offsetScalar: offsetScalar,\n    debug: debug,\n    \"rotation-z\": Math.PI,\n    visible: debug\n  }), /*#__PURE__*/React.createElement(\"meshBasicMaterial\", {\n    side: THREE.DoubleSide\n  })));\n});\nvar useFaceControls = function useFaceControls() {\n  return useContext(FaceControlsContext);\n}; //\n// Webcam\n//\n\nvar Webcam = /*#__PURE__*/forwardRef(function (_ref2, fref) {\n  var videoTextureSrc = _ref2.videoTextureSrc,\n    _ref2$autostart = _ref2.autostart,\n    autostart = _ref2$autostart === void 0 ? true : _ref2$autostart;\n  var videoTextureApiRef = useRef(null);\n  var faceControls = useFaceControls();\n  var stream = suspend( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          if (videoTextureSrc) {\n            _context.next = 6;\n            break;\n          }\n          _context.next = 3;\n          return navigator.mediaDevices.getUserMedia({\n            audio: false,\n            video: {\n              facingMode: 'user'\n            }\n          });\n        case 3:\n          _context.t0 = _context.sent;\n          _context.next = 7;\n          break;\n        case 6:\n          _context.t0 = Promise.resolve(null);\n        case 7:\n          return _context.abrupt(\"return\", _context.t0);\n        case 8:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee);\n  })), [videoTextureSrc]);\n  useEffect(function () {\n    faceControls.dispatchEvent({\n      type: 'stream',\n      stream: stream\n    });\n    return function () {\n      stream == null ? void 0 : stream.getTracks().forEach(function (track) {\n        return track.stop();\n      });\n      clear([videoTextureSrc]);\n    };\n  }, [stream, faceControls, videoTextureSrc]); // ref-api\n\n  var api = useMemo(function () {\n    return {\n      videoTextureApiRef: videoTextureApiRef\n    };\n  }, []);\n  useImperativeHandle(fref, function () {\n    return api;\n  }, [api]);\n  return /*#__PURE__*/React.createElement(Suspense, {\n    fallback: null\n  }, /*#__PURE__*/React.createElement(VideoTexture, {\n    ref: videoTextureApiRef,\n    src: videoTextureSrc || stream,\n    start: autostart\n  }));\n}); //\n// VideoTexture\n//\n\nvar VideoTexture = /*#__PURE__*/forwardRef(function (_ref4, fref) {\n  var src = _ref4.src,\n    start = _ref4.start;\n  var texture = useVideoTexture(src, {\n    start: start\n  });\n  var video = texture.source.data;\n  var faceControls = useFaceControls();\n  var onVideoFrame = useCallback(function (time) {\n    faceControls.dispatchEvent({\n      type: 'videoFrame',\n      texture: texture,\n      time: time\n    });\n  }, [texture, faceControls]);\n  useVideoFrame(video, onVideoFrame); // ref-api\n\n  var api = useMemo(function () {\n    return {\n      texture: texture\n    };\n  }, [texture]);\n  useImperativeHandle(fref, function () {\n    return api;\n  }, [api]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null);\n});\nvar useVideoFrame = function useVideoFrame(video, f) {\n  // https://web.dev/requestvideoframecallback-rvfc/\n  // https://www.remotion.dev/docs/video-manipulation\n  useEffect(function () {\n    if (!video || !video.requestVideoFrameCallback) return;\n    var handle;\n    function callback() {\n      f.apply(void 0, arguments);\n      handle = video.requestVideoFrameCallback(callback);\n    }\n    video.requestVideoFrameCallback(callback);\n    return function () {\n      return video.cancelVideoFrameCallback(handle);\n    };\n  }, [video, f]);\n};\nexport { FaceControls, useFaceControls };","map":{"version":3,"names":["_extends","THREE","React","forwardRef","useRef","useState","useCallback","useMemo","useImperativeHandle","useEffect","Suspense","useContext","createContext","useThree","useFrame","easing","suspend","clear","useVideoTexture","Facemesh","useFaceLandmarker","mean","v1","v2","clone","add","multiplyScalar","localToLocal","objSrc","v","objDst","v_world","localToWorld","worldToLocal","FaceControlsContext","FaceControls","_ref","fref","camera","_ref$autostart","autostart","_ref$webcam","webcam","webcamVideoTextureSrc","_ref$manualUpdate","manualUpdate","_ref$manualDetect","manualDetect","onVideoFrame","_ref$smoothTime","smoothTime","_ref$offset","offset","_ref$offsetScalar","offsetScalar","_ref$eyes","eyes","_ref$eyesAsOrigin","eyesAsOrigin","_ref$depth","depth","_ref$debug","debug","facemesh","makeDefault","_faces$facialTransfor","_faces$faceBlendshape","scene","state","defaultCamera","set","get","explCamera","webcamApiRef","facemeshApiRef","_useState","Object3D","_useState2","_slicedToArray","target","_useState3","Vector3","_useState4","irisRightDirPos","_useState5","_useState6","irisLeftDirPos","_useState7","_useState8","irisRightLookAt","_useState9","_useState10","irisLeftLookAt","computeTarget","parent","facemeshApi","current","outerRef","eyeRightRef","eyeLeftRef","irisRightDirRef","irisDirRef","irisLeftDirRef","copy","position","lookAt","_useState11","_useState12","update","delta","_target","eps","damp3","undefined","dampE","rotation","_useState13","_useState14","faces","setFaces","faceLandmarker","detect","video","time","detectForVideo","_","api","Object","assign","create","EventDispatcher","prototype","play","_webcamApiRef$current","_webcamApiRef$current2","videoTextureApiRef","texture","source","data","pause","_webcamApiRef$current3","_webcamApiRef$current4","onVideoFrameCb","e","addEventListener","removeEventListener","old","controls","points","faceLandmarks","facialTransformationMatrix","facialTransformationMatrixes","faceBlendshapes","createElement","Provider","value","fallback","Webcam","ref","videoTextureSrc","Math","PI","visible","side","DoubleSide","useFaceControls","_ref2","_ref2$autostart","faceControls","stream","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","navigator","mediaDevices","getUserMedia","audio","facingMode","t0","sent","Promise","resolve","abrupt","stop","dispatchEvent","type","getTracks","forEach","track","VideoTexture","src","start","_ref4","useVideoFrame","Fragment","f","requestVideoFrameCallback","handle","callback","apply","arguments","cancelVideoFrameCallback"],"sources":["/Users/rizzytwizzy/Projects/gam3/node_modules/@react-three/drei/core/FaceControls.js"],"sourcesContent":["import _extends from '@babel/runtime/helpers/esm/extends';\nimport * as THREE from 'three';\nimport * as React from 'react';\nimport { forwardRef, useRef, useState, useCallback, useMemo, useImperativeHandle, useEffect, Suspense, useContext, createContext } from 'react';\nimport { useThree, useFrame } from '@react-three/fiber';\nimport { easing } from 'maath';\nimport { suspend, clear } from 'suspend-react';\nimport { useVideoTexture } from './useVideoTexture.js';\nimport { Facemesh } from './Facemesh.js';\nimport { useFaceLandmarker } from './FaceLandmarker.js';\n\n// useVideoTexture 1st arg `src` type\nfunction mean(v1, v2) {\n  return v1.clone().add(v2).multiplyScalar(0.5);\n}\n\nfunction localToLocal(objSrc, v, objDst) {\n  // see: https://discourse.threejs.org/t/object3d-localtolocal/51564\n  const v_world = objSrc.localToWorld(v);\n  return objDst.worldToLocal(v_world);\n} //\n//\n//\n\n\nconst FaceControlsContext = /*#__PURE__*/createContext({});\nconst FaceControls = /*#__PURE__*/forwardRef(({\n  camera,\n  autostart = true,\n  webcam = true,\n  webcamVideoTextureSrc,\n  manualUpdate = false,\n  manualDetect = false,\n  onVideoFrame,\n  smoothTime = 0.25,\n  offset = true,\n  offsetScalar = 80,\n  eyes = false,\n  eyesAsOrigin = true,\n  depth = 0.15,\n  debug = false,\n  facemesh,\n  makeDefault\n}, fref) => {\n  var _faces$facialTransfor, _faces$faceBlendshape;\n\n  const scene = useThree(state => state.scene);\n  const defaultCamera = useThree(state => state.camera);\n  const set = useThree(state => state.set);\n  const get = useThree(state => state.get);\n  const explCamera = camera || defaultCamera;\n  const webcamApiRef = useRef(null);\n  const facemeshApiRef = useRef(null); //\n  // computeTarget()\n  //\n  // Compute `target` position and rotation for the camera (according to <Facemesh>)\n  //\n  //  1. ðŸ‘€ either following the 2 eyes\n  //  2. ðŸ‘¤ or just the head mesh\n  //\n\n  const [target] = useState(() => new THREE.Object3D());\n  const [irisRightDirPos] = useState(() => new THREE.Vector3());\n  const [irisLeftDirPos] = useState(() => new THREE.Vector3());\n  const [irisRightLookAt] = useState(() => new THREE.Vector3());\n  const [irisLeftLookAt] = useState(() => new THREE.Vector3());\n  const computeTarget = useCallback(() => {\n    // same parent as the camera\n    target.parent = explCamera.parent;\n    const facemeshApi = facemeshApiRef.current;\n\n    if (facemeshApi) {\n      const {\n        outerRef,\n        eyeRightRef,\n        eyeLeftRef\n      } = facemeshApi;\n\n      if (eyeRightRef.current && eyeLeftRef.current) {\n        // 1. ðŸ‘€\n        const {\n          irisDirRef: irisRightDirRef\n        } = eyeRightRef.current;\n        const {\n          irisDirRef: irisLeftDirRef\n        } = eyeLeftRef.current;\n\n        if (irisRightDirRef.current && irisLeftDirRef.current && outerRef.current) {\n          //\n          // position: mean of irisRightDirPos,irisLeftDirPos\n          //\n          irisRightDirPos.copy(localToLocal(irisRightDirRef.current, new THREE.Vector3(0, 0, 0), outerRef.current));\n          irisLeftDirPos.copy(localToLocal(irisLeftDirRef.current, new THREE.Vector3(0, 0, 0), outerRef.current));\n          target.position.copy(localToLocal(outerRef.current, mean(irisRightDirPos, irisLeftDirPos), explCamera.parent || scene)); //\n          // lookAt: mean of irisRightLookAt,irisLeftLookAt\n          //\n\n          irisRightLookAt.copy(localToLocal(irisRightDirRef.current, new THREE.Vector3(0, 0, 1), outerRef.current));\n          irisLeftLookAt.copy(localToLocal(irisLeftDirRef.current, new THREE.Vector3(0, 0, 1), outerRef.current));\n          target.lookAt(outerRef.current.localToWorld(mean(irisRightLookAt, irisLeftLookAt)));\n        }\n      } else {\n        // 2. ðŸ‘¤\n        if (outerRef.current) {\n          target.position.copy(localToLocal(outerRef.current, new THREE.Vector3(0, 0, 0), explCamera.parent || scene));\n          target.lookAt(outerRef.current.localToWorld(new THREE.Vector3(0, 0, 1)));\n        }\n      }\n    }\n\n    return target;\n  }, [explCamera, irisLeftDirPos, irisLeftLookAt, irisRightDirPos, irisRightLookAt, scene, target]); //\n  // update()\n  //\n  // Updating the camera `current` position and rotation, following `target`\n  //\n\n  const [current] = useState(() => new THREE.Object3D());\n  const update = useCallback(function (delta, target) {\n    if (explCamera) {\n      var _target;\n\n      (_target = target) !== null && _target !== void 0 ? _target : target = computeTarget();\n\n      if (smoothTime > 0) {\n        // damping current\n        const eps = 1e-9;\n        easing.damp3(current.position, target.position, smoothTime, delta, undefined, undefined, eps);\n        easing.dampE(current.rotation, target.rotation, smoothTime, delta, undefined, undefined, eps);\n      } else {\n        // instant\n        current.position.copy(target.position);\n        current.rotation.copy(target.rotation);\n      }\n\n      explCamera.position.copy(current.position);\n      explCamera.rotation.copy(current.rotation);\n    }\n  }, [explCamera, computeTarget, smoothTime, current.position, current.rotation]); //\n  // detect()\n  //\n\n  const [faces, setFaces] = useState();\n  const faceLandmarker = useFaceLandmarker();\n  const detect = useCallback((video, time) => {\n    const faces = faceLandmarker == null ? void 0 : faceLandmarker.detectForVideo(video, time);\n    setFaces(faces);\n  }, [faceLandmarker]);\n  useFrame((_, delta) => {\n    if (!manualUpdate) {\n      update(delta);\n    }\n  }); // Ref API\n\n  const api = useMemo(() => Object.assign(Object.create(THREE.EventDispatcher.prototype), {\n    detect,\n    computeTarget,\n    update,\n    facemeshApiRef,\n    webcamApiRef,\n    // shorthands\n    play: () => {\n      var _webcamApiRef$current, _webcamApiRef$current2;\n\n      (_webcamApiRef$current = webcamApiRef.current) == null ? void 0 : (_webcamApiRef$current2 = _webcamApiRef$current.videoTextureApiRef.current) == null ? void 0 : _webcamApiRef$current2.texture.source.data.play();\n    },\n    pause: () => {\n      var _webcamApiRef$current3, _webcamApiRef$current4;\n\n      (_webcamApiRef$current3 = webcamApiRef.current) == null ? void 0 : (_webcamApiRef$current4 = _webcamApiRef$current3.videoTextureApiRef.current) == null ? void 0 : _webcamApiRef$current4.texture.source.data.pause();\n    }\n  }), [detect, computeTarget, update]);\n  useImperativeHandle(fref, () => api, [api]); //\n  // events callbacks\n  //\n\n  useEffect(() => {\n    const onVideoFrameCb = e => {\n      if (!manualDetect) detect(e.texture.source.data, e.time);\n      if (onVideoFrame) onVideoFrame(e);\n    };\n\n    api.addEventListener('videoFrame', onVideoFrameCb);\n    return () => {\n      api.removeEventListener('videoFrame', onVideoFrameCb);\n    };\n  }, [api, detect, faceLandmarker, manualDetect, onVideoFrame]); // `controls` global state\n\n  useEffect(() => {\n    if (makeDefault) {\n      const old = get().controls;\n      set({\n        controls: api\n      });\n      return () => set({\n        controls: old\n      });\n    }\n  }, [makeDefault, api, get, set]);\n  const points = faces == null ? void 0 : faces.faceLandmarks[0];\n  const facialTransformationMatrix = faces == null ? void 0 : (_faces$facialTransfor = faces.facialTransformationMatrixes) == null ? void 0 : _faces$facialTransfor[0];\n  const faceBlendshapes = faces == null ? void 0 : (_faces$faceBlendshape = faces.faceBlendshapes) == null ? void 0 : _faces$faceBlendshape[0];\n  return /*#__PURE__*/React.createElement(FaceControlsContext.Provider, {\n    value: api\n  }, webcam && /*#__PURE__*/React.createElement(Suspense, {\n    fallback: null\n  }, /*#__PURE__*/React.createElement(Webcam, {\n    ref: webcamApiRef,\n    autostart: autostart,\n    videoTextureSrc: webcamVideoTextureSrc\n  })), /*#__PURE__*/React.createElement(Facemesh, _extends({\n    ref: facemeshApiRef\n  }, facemesh, {\n    points: points,\n    depth: depth,\n    facialTransformationMatrix: facialTransformationMatrix,\n    faceBlendshapes: faceBlendshapes,\n    eyes: eyes,\n    eyesAsOrigin: eyesAsOrigin,\n    offset: offset,\n    offsetScalar: offsetScalar,\n    debug: debug,\n    \"rotation-z\": Math.PI,\n    visible: debug\n  }), /*#__PURE__*/React.createElement(\"meshBasicMaterial\", {\n    side: THREE.DoubleSide\n  })));\n});\nconst useFaceControls = () => useContext(FaceControlsContext); //\n// Webcam\n//\n\nconst Webcam = /*#__PURE__*/forwardRef(({\n  videoTextureSrc,\n  autostart = true\n}, fref) => {\n  const videoTextureApiRef = useRef(null);\n  const faceControls = useFaceControls();\n  const stream = suspend(async () => {\n    return !videoTextureSrc ? await navigator.mediaDevices.getUserMedia({\n      audio: false,\n      video: {\n        facingMode: 'user'\n      }\n    }) : Promise.resolve(null);\n  }, [videoTextureSrc]);\n  useEffect(() => {\n    faceControls.dispatchEvent({\n      type: 'stream',\n      stream\n    });\n    return () => {\n      stream == null ? void 0 : stream.getTracks().forEach(track => track.stop());\n      clear([videoTextureSrc]);\n    };\n  }, [stream, faceControls, videoTextureSrc]); // ref-api\n\n  const api = useMemo(() => ({\n    videoTextureApiRef\n  }), []);\n  useImperativeHandle(fref, () => api, [api]);\n  return /*#__PURE__*/React.createElement(Suspense, {\n    fallback: null\n  }, /*#__PURE__*/React.createElement(VideoTexture, {\n    ref: videoTextureApiRef,\n    src: videoTextureSrc || stream,\n    start: autostart\n  }));\n}); //\n// VideoTexture\n//\n\nconst VideoTexture = /*#__PURE__*/forwardRef(({\n  src,\n  start\n}, fref) => {\n  const texture = useVideoTexture(src, {\n    start\n  });\n  const video = texture.source.data;\n  const faceControls = useFaceControls();\n  const onVideoFrame = useCallback(time => {\n    faceControls.dispatchEvent({\n      type: 'videoFrame',\n      texture,\n      time\n    });\n  }, [texture, faceControls]);\n  useVideoFrame(video, onVideoFrame); // ref-api\n\n  const api = useMemo(() => ({\n    texture\n  }), [texture]);\n  useImperativeHandle(fref, () => api, [api]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null);\n});\n\nconst useVideoFrame = (video, f) => {\n  // https://web.dev/requestvideoframecallback-rvfc/\n  // https://www.remotion.dev/docs/video-manipulation\n  useEffect(() => {\n    if (!video || !video.requestVideoFrameCallback) return;\n    let handle;\n\n    function callback(...args) {\n      f(...args);\n      handle = video.requestVideoFrameCallback(callback);\n    }\n\n    video.requestVideoFrameCallback(callback);\n    return () => video.cancelVideoFrameCallback(handle);\n  }, [video, f]);\n};\n\nexport { FaceControls, useFaceControls };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}